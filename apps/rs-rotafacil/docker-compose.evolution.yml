version: '3.8'

services:
  evolution-api:
    image: atendai/evolution-api:v2.1.1
    container_name: rs-evolution
    restart: unless-stopped
    ports:
      - "8081:8080" # Porta externa 8081 para n√£o conflitar com o Vite (8080)
    environment:
      - SERVER_TYPE=http
      - SERVER_PORT=8080
      - SERVER_URL=https://${EVO_DOMAIN}
      - AUTH_TYPE=apikey
      - AUTH_API_KEY=${EVO_API_KEY:-429683C4C977415CAAFCCE10F0D57110}
      - REDIS_ENABLED=true
      - REDIS_HOST=redis-evo
      - REDIS_PORT=6379
    depends_on:
      - redis-evo
    networks:
      - infra-network

  redis-evo:
    image: redis:7-alpine
    container_name: rs-redis-evo
    restart: unless-stopped
    command: redis-server --appendonly yes
    volumes:
      - redis_evo_data:/data
    networks:
      - infra-network

networks:
  infra-network:
    external: true

volumes:
  redis_evo_data:
