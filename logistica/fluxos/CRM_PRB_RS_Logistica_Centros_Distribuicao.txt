CRM / PRB � M�DULO LOG�STICO (CENTROS DE DISTRIBUI��O RS PR�LIPSI)
Documento relacional e operacional do m�dulo Log�stico RS Pr�lipsi, respons�vel pelos Centros de Distribui��o (CDs). Define todas as rela��es entre as tabelas, integra��es, triggers, relat�rios cruzados e indicadores, garantindo rastreabilidade total de pedidos, estoques, repasses e pontua��o SIGMA.
1. Estrutura e Finalidade

O CRM / PRB do m�dulo Log�stico define a rela��o de dados entre os Centros de Distribui��o (CDs) e os demais m�dulos do ecossistema RS Pr�lipsi. 
Ele garante que cada venda, pedido e repasse financeiro seja rastre�vel, audit�vel e associado corretamente ao CD respons�vel.

2. Estrutura Central de Banco de Dados

Tabela | Fun��o | Origem / M�dulo | Atualiza��o
--------|---------|-----------------|--------------
distribution_centers | Cadastro base dos CDs | Admin | Manual / Autom�tica
cd_products | Produtos espelhados do Marketplace | Marketplace | Autom�tica (API)
cd_orders | Pedidos processados por cada CD | Marketplace | Autom�tica
cd_inventory | Controle de estoque interno | CD / Admin | Tempo real
cd_wallet | Movimenta��es financeiras do CD | WalletPay | Webhook
cd_shipments | Controle de entregas e fretes | CD / Log�stica | Manual / Autom�tica
cd_bonuses | Registro de pontos gerados | SIGMA | Autom�tica
cd_logs | A��es e auditorias do CD | Admin | Autom�tica

3. Relacionamentos Entre Tabelas

Rela��o | Descri��o | Tipo
----------|------------|------
distribution_centers.id ? cd_products.cd_id | Cada CD possui seus pr�prios produtos espelhados | 1:N
distribution_centers.id ? cd_orders.cd_id | Cada pedido pertence a um CD espec�fico | 1:N
distribution_centers.id ? cd_inventory.cd_id | Estoque individual por CD | 1:1
distribution_centers.id ? cd_wallet.cd_id | Rela��o financeira do CD com WalletPay | 1:1
cd_orders.id ? cd_shipments.order_id | Entregas vinculadas a pedidos | 1:1
cd_orders.id ? cd_bonuses.order_id | Cada pedido pode gerar pontos de rede SIGMA | 1:1

4. Campos Sincronizados Entre M�dulos

Campo | Origem | Destino | Tipo de Sincroniza��o
--------|---------|----------|------------------------
produto_id, preco, descricao, estoque | Marketplace | cd_products | Autom�tica (API)
pedido_id, status, valor_total | Marketplace | cd_orders | Autom�tica
saldo, repasses, taxas | WalletPay | cd_wallet | Webhook
pontos_gerados, bonus_valor | SIGMA | cd_bonuses | Autom�tica
status_entrega, data_envio, transportadora | CD | cd_shipments | Manual / Autom�tica
status_cd, tipo_cd, gestor_id | Admin | distribution_centers | Manual

5. Triggers e Processos Autom�ticos

Trigger | A��o | M�dulo Origem | M�dulo Destino
----------|------|----------------|----------------
AFTER INSERT cd_orders | Cria registro financeiro e log�stico | Marketplace | WalletPay / SIGMA
AFTER UPDATE cd_orders.status | Atualiza status de entrega e pontua��o | CD | Admin / SIGMA
AFTER UPDATE cd_inventory | Atualiza estoque no Admin e Marketplace | CD | Admin / Marketplace
AFTER INSERT cd_wallet | Gera repasse e notifica��o financeira | WalletPay | Admin / CD
AFTER UPDATE cd_shipments | Atualiza relat�rios de entrega e auditoria | CD | Admin
AFTER INSERT cd_bonuses | Credita pontos de rede e volume SIGMA | SIGMA | Admin

6. Relat�rios Cruzados e Consultas SQL

Relat�rio A � Volume de Vendas por CD:
SELECT dc.nome, SUM(o.valor_total) AS total_vendas
FROM cd_orders o
JOIN distribution_centers dc ON dc.id = o.cd_id
GROUP BY dc.nome;

Relat�rio B � Estoque Atual por CD:
SELECT dc.nome, p.nome_produto, i.quantidade
FROM cd_inventory i
JOIN cd_products p ON p.produto_id = i.produto_id
JOIN distribution_centers dc ON dc.id = i.cd_id;

Relat�rio C � Pontua��o Gerada (SIGMA):
SELECT dc.nome, SUM(b.pontos_gerados) AS total_pontos
FROM cd_bonuses b
JOIN distribution_centers dc ON dc.id = b.cd_id
GROUP BY dc.nome;

7. Fluxo Operacional Completo

1. Admin cadastra o CD e define gestor e regi�o.
2. Marketplace sincroniza produtos automaticamente.
3. CD processa pedidos locais e gera registro em cd_orders.
4. WalletPay cria registro financeiro e efetua repasse ao CD.
5. SIGMA recebe pontua��o correspondente e distribui b�nus de rede.
6. Admin visualiza tudo em tempo real no painel de auditoria.

8. Indicadores e Dashboards

Indicador | Fonte | Descri��o
------------|--------|-----------
Volume total de vendas | cd_orders | Soma geral de vendas por CD
Pontua��o total gerada | cd_bonuses | Pontos SIGMA atribu�dos �s vendas
Repasses efetuados | cd_wallet | Valor total de repasses via WalletPay
Estoque dispon�vel | cd_inventory | Quantidade atualizada por produto
Pedidos pendentes | cd_orders | Entregas ainda n�o conclu�das
CDs ativos | distribution_centers | Total de CDs operacionais

9. Seguran�a e Controle

- Logs de todas as a��es (cd_logs)
- Controle de acesso por perfil (Gestor CD, Admin, Financeiro)
- Criptografia AES para dados financeiros
- Auditoria cruzada entre WalletPay e SIGMA
- Backup incremental di�rio no Supabase
- Conformidade LGPD (dados de clientes e transportes anonimizados)

10. Roadmap de Evolu��o

Fase | Entrega | Descri��o
------|----------|-----------
Fase 1 | Estrutura relacional completa | Cadastro e espelhamento de produtos
Fase 2 | Integra��o financeira | Repasses autom�ticos via WalletPay
Fase 3 | Controle de estoque e relat�rios cruzados | Sincroniza��o Admin ? CD ? Marketplace
Fase 4 | SIGMA integrado | Pontua��o e ciclos autom�ticos por CD
Fase 5 | RS.IA | Intelig�ncia preditiva de vendas e alertas de estoque
